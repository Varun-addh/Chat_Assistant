<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Diagram Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        textarea {
            width: 100%;
            height: 150px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 5px;
        }
        .diagram-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin-top: 15px;
            background-color: #fafafa;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .preset-buttons {
            margin: 10px 0;
        }
        .preset-buttons button {
            background-color: #27ae60;
            margin: 2px;
            padding: 5px 10px;
            font-size: 12px;
        }
        .preset-buttons button:hover {
            background-color: #229954;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Mermaid Diagram Tester</h1>
        
        <div class="test-section">
            <h3>üìù Custom Diagram Test</h3>
            <p>Enter your Mermaid code and test it:</p>
            
            <textarea id="customCode" placeholder="Enter your Mermaid code here...">flowchart TD
  A[Start] --> B[Process]
  B --> C[End]</textarea>
            
            <div>
                <label for="theme">Theme:</label>
                <select id="theme">
                    <option value="default">Default</option>
                    <option value="dark">Dark</option>
                    <option value="forest">Forest</option>
                    <option value="neutral">Neutral</option>
                </select>
                
                <button onclick="testCustomDiagram()">Test Custom Diagram</button>
                <button onclick="clearCustom()">Clear</button>
            </div>
            
            <div id="customStatus"></div>
            <div id="customDiagram" class="diagram-container">
                <p style="color: #666;">Your diagram will appear here...</p>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üöÄ Preset Diagram Tests</h3>
            <p>Test different types of diagrams:</p>
            
            <div class="preset-buttons">
                <button onclick="loadPreset('system')">System Architecture</button>
                <button onclick="loadPreset('er')">ER Diagram</button>
                <button onclick="loadPreset('sequence')">Sequence Diagram</button>
                <button onclick="loadPreset('class')">Class Diagram</button>
                <button onclick="loadPreset('state')">State Diagram</button>
                <button onclick="loadPreset('ui')">UI Design</button>
            </div>
            
            <div>
                <label for="presetTheme">Theme:</label>
                <select id="presetTheme">
                    <option value="default">Default</option>
                    <option value="dark">Dark</option>
                    <option value="forest">Forest</option>
                    <option value="neutral">Neutral</option>
                </select>
                
                <button onclick="testPresetDiagram()">Test Preset Diagram</button>
            </div>
            
            <div id="presetStatus"></div>
            <div id="presetDiagram" class="diagram-container">
                <p style="color: #666;">Preset diagram will appear here...</p>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîß API Testing</h3>
            <p>Test the API endpoints directly:</p>
            
            <button onclick="testHealthEndpoint()">Test Health Endpoint</button>
            <button onclick="testSimpleDiagram()">Test Simple Diagram</button>
            <button onclick="testComplexDiagram()">Test Complex Diagram</button>
            
            <div id="apiStatus"></div>
        </div>
    </div>

    <script>
        // Preset diagrams
        const presets = {
            system: `flowchart TD
subgraph Client[Client Layer]
  Web[Web App]:::client
  Mobile[Mobile App]:::client
end
subgraph Networking[Networking Layer]
  LB[Load Balancer]:::lb
  GW[API Gateway]:::gateway
end
subgraph Services[Application Layer]
  AS[Availability Service Read]:::service
  BS[Booking Service Write]:::service
  NS[Notification Service]:::service
end
subgraph Data[Data Layer]
  Redis[Redis Cache]:::cache
  Postgres[Postgres RDBMS]:::db
  Kafka[Kafka MQ]:::mq
end
  Web --> LB
  Mobile --> LB
  LB --> GW
  GW --> AS
  GW --> BS
  AS --> Redis
  AS --> Postgres
  BS --> Postgres
  BS --> Kafka
  Kafka --> NS
classDef client fill:#e1f5fe,stroke:#01579b,color:#000
classDef lb fill:#fff3e0,stroke:#e65100,color:#000
classDef gateway fill:#e8f5e8,stroke:#1b5e20,color:#000
classDef service fill:#fff8e1,stroke:#f57f17,color:#000
classDef db fill:#e3f2fd,stroke:#0d47a1,color:#000
classDef cache fill:#fff3e0,stroke:#f57c00,color:#000
classDef mq fill:#f0f4c3,stroke:#827717,color:#000`,

            er: `erDiagram
    USER ||--o{ ORDER : places
    USER {
        int id PK
        string name
        string email
        datetime created_at
    }
    ORDER {
        int id PK
        int user_id FK
        decimal total
        string status
        datetime created_at
    }
    PRODUCT ||--o{ ORDER_ITEM : contains
    PRODUCT {
        int id PK
        string name
        decimal price
        int stock
    }
    ORDER_ITEM {
        int id PK
        int order_id FK
        int product_id FK
        int quantity
        decimal price
    }`,

            sequence: `sequenceDiagram
    participant U as User
    participant W as Web App
    participant A as API Gateway
    participant S as Service
    participant D as Database
    
    U->>W: Login Request
    W->>A: Authenticate User
    A->>S: Validate Credentials
    S->>D: Check User Data
    D-->>S: User Data
    S-->>A: Authentication Result
    A-->>W: JWT Token
    W-->>U: Login Success`,

            class: `classDiagram
    class User {
        +int id
        +string name
        +string email
        +datetime created_at
        +login()
        +logout()
        +updateProfile()
    }
    class Order {
        +int id
        +int user_id
        +decimal total
        +string status
        +datetime created_at
        +addItem()
        +calculateTotal()
        +updateStatus()
    }
    class Product {
        +int id
        +string name
        +decimal price
        +int stock
        +updateStock()
        +getPrice()
    }
    User ||--o{ Order : places
    Order ||--o{ Product : contains`,

            state: `stateDiagram-v2
    [*] --> Idle
    Idle --> Processing : start_request
    Processing --> Success : complete_successfully
    Processing --> Error : fail_with_error
    Success --> Idle : reset
    Error --> Idle : reset
    Idle --> [*] : shutdown
    
    state Processing {
        [*] --> Validating
        Validating --> Processing_Data : valid
        Validating --> Error : invalid
        Processing_Data --> Success : done
        Processing_Data --> Error : timeout
    }`,

            ui: `flowchart TD
    HP[Homepage Container]
    HP --> A[Header Sticky Navigation Logo Search]
    HP --> B[Hero Section Max 1 Featured Story + 3 Sub-Stories]
    HP --> C[Main Content Grid Modular & Dynamic]
    C --> C1[Module 1 Must Reads Local News]
    C --> C2[Module 2 Opinion & Analysis]
    C --> C3[Sidebar Trending Topics High-Value Ads Widgets]
    C --> C4[Module 3 International & Sports Lazy Loaded]
    HP --> D[Footer Legal Links Site Map]`
        };

        let currentPreset = '';

        // Test custom diagram
        async function testCustomDiagram() {
            const code = document.getElementById('customCode').value;
            const theme = document.getElementById('theme').value;
            const statusDiv = document.getElementById('customStatus');
            const diagramDiv = document.getElementById('customDiagram');
            
            if (!code.trim()) {
                showStatus(statusDiv, 'error', 'Please enter Mermaid code');
                return;
            }
            
            await renderDiagram(code, theme, statusDiv, diagramDiv);
        }

        // Test preset diagram
        async function testPresetDiagram() {
            if (!currentPreset) {
                showStatus(document.getElementById('presetStatus'), 'error', 'Please select a preset diagram');
                return;
            }
            
            const code = presets[currentPreset];
            const theme = document.getElementById('presetTheme').value;
            const statusDiv = document.getElementById('presetStatus');
            const diagramDiv = document.getElementById('presetDiagram');
            
            await renderDiagram(code, theme, statusDiv, diagramDiv);
        }

        // Load preset diagram
        function loadPreset(type) {
            currentPreset = type;
            document.getElementById('presetStatus').innerHTML = '';
            document.getElementById('presetDiagram').innerHTML = '<p style="color: #666;">Preset diagram will appear here...</p>';
        }

        // Clear custom diagram
        function clearCustom() {
            document.getElementById('customCode').value = '';
            document.getElementById('customStatus').innerHTML = '';
            document.getElementById('customDiagram').innerHTML = '<p style="color: #666;">Your diagram will appear here...</p>';
        }

        // Render diagram
        async function renderDiagram(code, theme, statusDiv, diagramDiv) {
            showStatus(statusDiv, 'info', 'Rendering diagram...');
            
            try {
                const response = await fetch('http://localhost:8000/api/render_mermaid', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: code,
                        theme: theme
                    })
                });
                
                if (response.ok) {
                    const svg = await response.text();
                    diagramDiv.innerHTML = svg;
                    showStatus(statusDiv, 'success', `‚úÖ Diagram rendered successfully! SVG length: ${svg.length} characters`);
                } else {
                    const errorText = await response.text();
                    showStatus(statusDiv, 'error', `‚ùå Error ${response.status}: ${errorText}`);
                    diagramDiv.innerHTML = '<p style="color: #e74c3c;">Failed to render diagram</p>';
                }
            } catch (error) {
                showStatus(statusDiv, 'error', `‚ùå Network error: ${error.message}`);
                diagramDiv.innerHTML = '<p style="color: #e74c3c;">Network error occurred</p>';
            }
        }

        // Show status message
        function showStatus(element, type, message) {
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Test health endpoint
        async function testHealthEndpoint() {
            const statusDiv = document.getElementById('apiStatus');
            showStatus(statusDiv, 'info', 'Testing health endpoint...');
            
            try {
                const response = await fetch('http://localhost:8000/health');
                if (response.ok) {
                    const data = await response.json();
                    showStatus(statusDiv, 'success', `‚úÖ Health check passed! Server version: ${data.version}`);
                } else {
                    showStatus(statusDiv, 'error', `‚ùå Health check failed: ${response.status}`);
                }
            } catch (error) {
                showStatus(statusDiv, 'error', `‚ùå Health check error: ${error.message}`);
            }
        }

        // Test simple diagram
        async function testSimpleDiagram() {
            const statusDiv = document.getElementById('apiStatus');
            showStatus(statusDiv, 'info', 'Testing simple diagram...');
            
            const simpleCode = `flowchart TD
  A[Start] --> B[End]`;
            
            try {
                const response = await fetch('http://localhost:8000/api/render_mermaid', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: simpleCode,
                        theme: 'default'
                    })
                });
                
                if (response.ok) {
                    const svg = await response.text();
                    showStatus(statusDiv, 'success', `‚úÖ Simple diagram test passed! SVG length: ${svg.length} characters`);
                } else {
                    const errorText = await response.text();
                    showStatus(statusDiv, 'error', `‚ùå Simple diagram test failed: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                showStatus(statusDiv, 'error', `‚ùå Simple diagram test error: ${error.message}`);
            }
        }

        // Test complex diagram
        async function testComplexDiagram() {
            const statusDiv = document.getElementById('apiStatus');
            showStatus(statusDiv, 'info', 'Testing complex diagram...');
            
            const complexCode = `flowchart TD
  subgraph Client[Client Layer]
    Web[Web App]:::client
    Mobile[Mobile App]:::client
  end
  subgraph Services[Application Layer]
    AS[Availability Service Read]:::service
    BS[Booking Service Write]:::service
  end
  Web --> AS
  AS --> BS
classDef client fill:#e1f5fe,stroke:#01579b,color:#000
classDef service fill:#fff8e1,stroke:#f57f17,color:#000`;
            
            try {
                const response = await fetch('http://localhost:8000/api/render_mermaid', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: complexCode,
                        theme: 'dark'
                    })
                });
                
                if (response.ok) {
                    const svg = await response.text();
                    showStatus(statusDiv, 'success', `‚úÖ Complex diagram test passed! SVG length: ${svg.length} characters`);
                } else {
                    const errorText = await response.text();
                    showStatus(statusDiv, 'error', `‚ùå Complex diagram test failed: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                showStatus(statusDiv, 'error', `‚ùå Complex diagram test error: ${error.message}`);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Mermaid Diagram Tester loaded');
            console.log('Make sure the server is running on http://localhost:8000');
        });
    </script>
</body>
</html>
